[{"id":"d004ec73.2ffb1","type":"redisPub","name":"errPageDisplay","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_tableerrPageCount","x":879.4445533752441,"y":952.0744075775146,"z":"603ff2c0.9fc00c","wires":[]},{"id":"9432341a.6bcdc8","type":"function","name":"errPageDisplay","useRequire":false,"func":"var temp=[];\nvar payload=[];\npayload.push([\"错误类型\",\"错误页面\",\"出错次数\"]);\nif(msg.payload.length>50)\n{\n    var len=50;\n}\nelse\n{\n    var len=msg.payload.length;\n}\nfor(var i=0;i<len-1;i+=2)\n{\n    temp=msg.payload[i].split(':');\n    var type=temp[0];\n    var url=temp[1];\n    var count=msg.payload[i+1];\n    payload.push([type,url,count]);\n}\npayload={\"value\":payload};\nmsg.payload={\n        \"MsgID\":\"adminpush_tableerrPageCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;","outputs":1,"x":645.1112594604492,"y":947.5189752578735,"z":"603ff2c0.9fc00c","wires":[["fc9ebc24.03614","d004ec73.2ffb1"]]},{"id":"92b6840c.6d4978","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"errPageDisplay","key":"errPageDisplay","structtype":"zset","x":419.2223777770996,"y":948.7411127090454,"z":"603ff2c0.9fc00c","wires":[["5d5ae14d.a2a52","9432341a.6bcdc8"]]},{"id":"f6f90650.0906f8","type":"inject","name":"2s","topic":"","payload":"","payloadType":"none","repeat":"2","crontab":"","once":false,"x":178.11125946044922,"y":1016.2964057922363,"z":"603ff2c0.9fc00c","wires":[["92b6840c.6d4978","66833384.997ccc"]]},{"id":"5d5ae14d.a2a52","type":"debug","name":"","active":false,"console":"false","complete":"false","x":404.6668167114258,"y":882.9632453918457,"z":"603ff2c0.9fc00c","wires":[]},{"id":"fc9ebc24.03614","type":"debug","name":"","active":false,"console":"false","complete":"false","x":622.4446182250977,"y":884.4077033996582,"z":"603ff2c0.9fc00c","wires":[]},{"id":"ae3b84f4.51c478","type":"function","name":"countUserAgent","useRequire":false,"func":"var user_agent=msg.payload.user_agent;\nmsg.payload={\"user_agent\":user_agent};\nreturn msg;","outputs":1,"x":613.0002136230469,"y":775.7408752441406,"z":"603ff2c0.9fc00c","wires":[["cd73924c.328c7"]]},{"id":"3b354bff.c4cab4","type":"function","name":"msgToJSON","useRequire":false,"func":"\nvar userIP=\"\";\nvar hostIP=\"\";\nif(msg.payload.indexOf(\"HTTP_TRACE_REP\")==0)\n{\n    var temp=msg.payload.split('#');\n    var type=temp[0].slice(0,temp[0].indexOf('|'));\n    userIP=temp[0].split('|')[3].split(':')[0];\n    hostIP=temp[0].split('|')[2].split(':')[0];\n    var last=temp[1];\n    var lastTemp=last.split('|');\n    var target=lastTemp[3];\n    var status=lastTemp[4];\n    var hoststring=last.substring(last.indexOf(\"Host: \")+6,last.length);\n    var host=hoststring.substring(0,hoststring.indexOf(' '));\n\tvar user_agent=\"\";\n\tif(last.indexOf(\"User-Agent: \")>0)\n\t{\n    \tvar user_agentstring=last.substring(last.indexOf(\"User-Agent: \")+12,last.length);\n    \tif(user_agentstring.indexOf(':')>0)\n    \t{\n        \tvar tempOfuserAgentString=user_agentstring.substring(0,user_agentstring.indexOf(':'));\n        \tvar tempstring=tempOfuserAgentString.split(' ');\n        \tvar len=tempstring.length;\n        \tfor(var i=0;i<len-1;++i)\n        \t{\n            \tuser_agent+=tempstring[i];\n        \t}\n    \t}\n    \telse\n    \t{\n        \tuser_agent=tempOfuserAgentString;\n    \t}\n\t}\n\telse\n\t{\n    \tuser_agent=\"\";\n\t}\n    if(last.indexOf(\"Referer: \")>0)\n    {\n    \tvar referer_string=last.substring(last.indexOf(\"Referer: \")+9,last.length);\n    \tif(referer_string.indexOf(' ')>0)\n    \t{\n    \t\tvar referer=referer_string.substring(0,referer_string.indexOf(' '));\n    \t}\n    \telse\n    \t{\n    \t\tvar referer=referer_string;\n    \t}\n    }\n    else\n    {\n    \tvar referer=\"\";\n    }\n    \n    msg.payload={\n        \"type\":type,\n        \"userIP\":userIP,\n        \"hostIP\":hostIP,\n        \"target\":target,\n        \"status\":status,\n        \"host\":host,\n        \"user_agent\":user_agent,\n        \"referer\":referer\n    };\n    return msg;\n}\nif(msg.payload.indexOf(\"HTTP_TRACE_REQ\")==0)\n{\n    var temp=msg.payload.split('#');\n    var type=temp[0].slice(0,temp[0].indexOf('|'));\n    hostIP=temp[0].split('|')[3].split(':')[0];\n    userIP=temp[0].split('|')[2].split(':')[0];\n    last=temp[1].split(\"|\")[3];\n    var target=last.substring(0,last.indexOf(' '));\n    var hoststring=last.substring(last.indexOf(\"Host: \")+6,last.length);\n    var host=hoststring.substring(0,hoststring.indexOf(' '));\n    var user_agent=\"\";\n\tif(last.indexOf(\"User-Agent: \")>0)\n\t{\n    \tvar user_agentstring=last.substring(last.indexOf(\"User-Agent: \")+12,last.length);\n    \tif(user_agentstring.indexOf(':')>0)\n    \t{\n        \tvar tempOfuserAgentString=user_agentstring.substring(0,user_agentstring.indexOf(':'));\n        \tvar tempstring=tempOfuserAgentString.split(' ');\n        \tvar len=tempstring.length;\n        \tfor(var i=0;i<len-1;++i)\n        \t{\n            \tuser_agent+=tempstring[i];\n        \t}\n    \t}\n    \telse\n    \t{\n        \tuser_agent=tempOfuserAgentString;\n    \t}\n\t}\n\telse\n\t{\n    \tuser_agent=\"\";\n\t}\n    if(last.indexOf(\"Referer: \")>0)\n    {\n    \tvar referer_string=last.substring(last.indexOf(\"Referer: \")+9,last.length);\n    \tif(referer_string.indexOf(' ')>0)\n    \t{\n    \t\tvar referer=referer_string.substring(0,referer_string.indexOf(' '));\n    \t}\n    \telse\n    \t{\n    \t\tvar referer=referer_string;\n    \t}\n    }\n    else\n    {\n    \tvar referer=\"\";\n    }\n    msg.payload={\n        \"type\":type,\n        \"userIP\":userIP,\n        \"hostIP\":hostIP,\n        \"target\":target,\n        \"host\":host,\n        \"user_agent\":user_agent,\n        \"referer\":referer\n    };\n    return msg;\n}","outputs":1,"x":360.54526138305664,"y":453.40761947631836,"z":"603ff2c0.9fc00c","wires":[["ae3b84f4.51c478","76121703.89ede8","afa55903.505aa8","8423277c.7bdcd8","382f565a.c7d0aa","55d05486.aa2fac","d105f0da.2efa1","ca12b2bb.35ed5"]]},{"id":"1eb5e697.e14a19","type":"redisSub","name":"Http_traceReader","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"http_trace","x":148.1007957458496,"y":456.62975788116455,"z":"603ff2c0.9fc00c","wires":[["3b354bff.c4cab4","7c087e3c.83f78"]]},{"id":"c010aecd.3fef5","type":"function","name":"errPageDisplay","useRequire":false,"func":"var time=(new Date()).getTime();\nvar errType=msg.payload.status;\nvar errURL=msg.payload.target;\n//var array=[errType,errURL];\nvar err=errType+':'+errURL;\nmsg.payload=['zincrby','errPageDisplay',1,err];\nreturn msg;\n","outputs":1,"x":793.3230400085449,"y":175.96322441101074,"z":"603ff2c0.9fc00c","wires":[["ef528428.10ad78","6096943c.9f696c"]]},{"id":"ef528428.10ad78","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"errPageDisplay","x":1017.8888549804688,"y":176.29630756378174,"z":"603ff2c0.9fc00c","wires":[]},{"id":"76121703.89ede8","type":"debug","name":"","active":false,"console":"false","complete":"false","x":349.1563415527344,"y":373.1853446960449,"z":"603ff2c0.9fc00c","wires":[]},{"id":"afa55903.505aa8","type":"function","name":"errPage","useRequire":false,"func":"if(msg.payload.type==\"HTTP_TRACE_REP\")\n{\n\tif(msg.payload.status.indexOf(\"3\")==0||msg.payload.status.indexOf(\"4\")==0||msg.payload.status.indexOf(\"5\")==0)\n\t{\n    \tvar errType=msg.payload.status;\n    \tvar errURL=msg.payload.target;\n    \tmsg.payload={\n    \t\t\"status\":errType,\n    \t\t\"target\":errURL\n    \t};\n    \treturn msg;\n\t}\n\n}","outputs":1,"x":568.7778015136719,"y":231.18533325195312,"z":"603ff2c0.9fc00c","wires":[["c010aecd.3fef5","af5f40c2.50a0c"]]},{"id":"6c711654.938ee8","type":"function","name":"visitPageCount","useRequire":false,"func":"var visitPage=msg.payload.visitPage;\nmsg.payload=['zincrby','visitPageCount',1,visitPage];\nreturn msg;","outputs":1,"x":796.876708984375,"y":414.11132431030273,"z":"603ff2c0.9fc00c","wires":[["59f7da2e.a60824","eb85324a.147ad"]]},{"id":"8423277c.7bdcd8","type":"function","name":"visitPage","useRequire":false,"func":"if(msg.payload.type==\"HTTP_TRACE_REQ\")\n{\n\t\n\tif(msg.payload.target.indexOf(\".html\")>0)\n\t{\n\t\tvar visitPage=msg.payload.target;\n\t\tmsg.payload={\n\t\t\t\"visitPage\":visitPage\n\t\t};\n\t\treturn msg;\n\t}\n}\n","outputs":1,"x":580.3211059570312,"y":382.33340072631836,"z":"603ff2c0.9fc00c","wires":[["6c711654.938ee8","5911bb01.a6ee44"]]},{"id":"59f7da2e.a60824","type":"debug","name":"","active":false,"console":"false","complete":"false","x":789.7654418945312,"y":357.6668510437012,"z":"603ff2c0.9fc00c","wires":[]},{"id":"5911bb01.a6ee44","type":"debug","name":"","active":false,"console":"false","complete":"false","x":578.7901611328125,"y":304.14826583862305,"z":"603ff2c0.9fc00c","wires":[]},{"id":"7c087e3c.83f78","type":"debug","name":"","active":false,"console":"false","complete":"false","x":147.6667022705078,"y":381.8520164489746,"z":"603ff2c0.9fc00c","wires":[]},{"id":"15eb72f7.ea148d","type":"inject","name":"1s","topic":"","payload":"","payloadType":"none","repeat":"1","crontab":"","once":false,"x":194.7932834625244,"y":1278.4910507202148,"z":"603ff2c0.9fc00c","wires":[["972d8134.68d28","49d1fc87.b62e04","7a193e99.85e6c","91e9e604.6e1618"]]},{"id":"eb85324a.147ad","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"visitPageCount","x":1019.2654418945312,"y":409.1608238220215,"z":"603ff2c0.9fc00c","wires":[]},{"id":"972d8134.68d28","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"visitPageCount","key":"visitPageCount","structtype":"zset","x":417.5000915527344,"y":1239.7410278320312,"z":"603ff2c0.9fc00c","wires":[["84215ab2.7bdea8","f5c59be4.0a3a68"]]},{"id":"84215ab2.7bdea8","type":"function","name":"visitPageCount","useRequire":false,"func":"var temp=[];\nvar payload=[];\npayload.push([\"受访页面\",\"次数\"]);\nif(msg.payload.length>40)\n{\n    var len=40;\n}\nelse\n{\n    var len=msg.payload.length;\n}\nfor(var i=0;i<len-1;i+=2)\n{\n\tvar visitPage=msg.payload[i];\n\tvar count=parseInt(msg.payload[i+1]);\n    payload.push([visitPage,count]);\n}\npayload={\"value\":payload};\nmsg.payload={\n        \"MsgID\":\"adminpush_tablevisitPageCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;","outputs":1,"x":662.2223243713379,"y":1264.9077920913696,"z":"603ff2c0.9fc00c","wires":[["b6e3cfb2.491c3","9c60f0c5.639f1"]]},{"id":"f5c59be4.0a3a68","type":"debug","name":"","active":false,"console":"false","complete":"false","x":414.77785873413086,"y":1188.6299562454224,"z":"603ff2c0.9fc00c","wires":[]},{"id":"af5f40c2.50a0c","type":"function","name":"errTypeCount","useRequire":false,"func":"var errType=msg.payload.status;\nmsg.payload=['zincrby','errTypeCount',1,errType];\nreturn msg;","outputs":1,"x":793.666748046875,"y":306.0742301940918,"z":"603ff2c0.9fc00c","wires":[["92eeb775.6d1148","fa884a04.0577b8"]]},{"id":"92eeb775.6d1148","type":"debug","name":"","active":false,"console":"false","complete":"false","x":790.4445381164551,"y":230.51861953735352,"z":"603ff2c0.9fc00c","wires":[]},{"id":"66833384.997ccc","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"errTypeCount","key":"errTypeCount","structtype":"zset","x":412.4444808959961,"y":1082.1854839324951,"z":"603ff2c0.9fc00c","wires":[["c268f718.3d9708","6b6c8a1.f949374"]]},{"id":"6b6c8a1.f949374","type":"function","name":"errTypeCount","useRequire":false,"func":"var errType=[];\nvar count=[];\nvar payload=[];\nif(msg.payload.length>=12)\n{\n    var len=12;\n    for(var i=0;i<len-1;i+=2)\n\t{\n\t\terrType.push(msg.payload[i]);\n\t\tcount.push(parseInt(msg.payload[i+1]));\n\t}\n\tfor(var i=0;i<errType.length;++i)\n\t{\n\t\tvar out=[errType[i],count[i]];\n\t\tpayload.push(out);\n\t}\n\tpayload={\"value\":payload};\n\tmsg.payload={\n        \"MsgID\":\"adminpush_columnerrTypeCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\n\tmsg.payload = JSON.stringify(msg.payload);\n\treturn msg;\n}\n","outputs":1,"x":644.1111755371094,"y":1099.2966918945312,"z":"603ff2c0.9fc00c","wires":[["beb2707.f414d9","9bf7921e.64087"]]},{"id":"c268f718.3d9708","type":"debug","name":"","active":false,"console":"false","complete":"false","x":411.000057220459,"y":1026.6300344467163,"z":"603ff2c0.9fc00c","wires":[]},{"id":"fa884a04.0577b8","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"errTypeCount","x":1022.889030456543,"y":305.96316146850586,"z":"603ff2c0.9fc00c","wires":[]},{"id":"beb2707.f414d9","type":"debug","name":"","active":false,"console":"false","complete":"false","x":642.6543884277344,"y":1015.0619325637817,"z":"603ff2c0.9fc00c","wires":[]},{"id":"5deb4269.a214bc","type":"inject","name":"at12:00","topic":"","payload":"","payloadType":"none","repeat":"","crontab":"00 00 * * *","once":false,"x":113.43211364746094,"y":1911.9140625,"z":"603ff2c0.9fc00c","wires":[["d9226c75.26dd9","b2727173.4d8d9","14b87559.eb478b","28e60d77.d719f2","591b380b.a6e4c8","d921fa9c.26de08"]]},{"id":"d9226c75.26dd9","type":"function","name":"del errPageDisplay","useRequire":false,"func":"msg.payload = ['del','errPageDisplay'];\nreturn msg;","outputs":1,"x":466.2099151611328,"y":1834.123483657837,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"b2727173.4d8d9","type":"function","name":"del errTypeCount","useRequire":false,"func":"msg.payload = ['del','errTypeCount'];\nreturn msg;","outputs":1,"x":457.32098388671875,"y":1884.8028564453125,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"14b87559.eb478b","type":"function","name":"del visitPageCount","useRequire":false,"func":"msg.payload = ['del','visitPageCount'];\nreturn msg;","outputs":1,"x":461.20989990234375,"y":1935.4696044921875,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"68287180.97d79","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"clean redis","x":833.5433654785156,"y":1940.75341796875,"z":"603ff2c0.9fc00c","wires":[]},{"id":"b6e3cfb2.491c3","type":"debug","name":"","active":false,"console":"false","complete":"false","x":659.6543998718262,"y":1206.160771369934,"z":"603ff2c0.9fc00c","wires":[]},{"id":"382f565a.c7d0aa","type":"function","name":"refererCount","useRequire":false,"func":"if(msg.payload.referer!=\"\")\n{\n\tvar referer=msg.payload.referer;\n\tmsg.payload={\"referer\":referer};\n\treturn msg;\n}","outputs":1,"x":595.8890342712402,"y":539.0001535415649,"z":"603ff2c0.9fc00c","wires":[["28615660.d79eaa","5e2567bf.a1da98"]]},{"id":"28615660.d79eaa","type":"function","name":"refererCount","useRequire":false,"func":"var referer=msg.payload.referer;\nmsg.payload=['zincrby','refererCount',1,referer];\nreturn msg;","outputs":1,"x":803.8890342712402,"y":540.8890085220337,"z":"603ff2c0.9fc00c","wires":[["ef239e16.10dc6","d3b05684.2c4fa8"]]},{"id":"ef239e16.10dc6","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"refererCount","x":1022.8890342712402,"y":536.8890085220337,"z":"603ff2c0.9fc00c","wires":[]},{"id":"5e2567bf.a1da98","type":"debug","name":"","active":false,"console":"false","complete":"false","x":583.8889770507812,"y":459.8890037536621,"z":"603ff2c0.9fc00c","wires":[]},{"id":"d3b05684.2c4fa8","type":"debug","name":"","active":false,"console":"false","complete":"false","x":799.8889770507812,"y":467.8890037536621,"z":"603ff2c0.9fc00c","wires":[]},{"id":"2f86f6aa.d0790a","type":"debug","name":"","active":false,"console":"false","complete":"false","x":416.8889465332031,"y":1302.6670532226562,"z":"603ff2c0.9fc00c","wires":[]},{"id":"49d1fc87.b62e04","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"refererCount","key":"refererCount","structtype":"zset","x":421.6111755371094,"y":1346.7779541015625,"z":"603ff2c0.9fc00c","wires":[["86fc322f.7903d"]]},{"id":"eae10e83.151ef","type":"debug","name":"","active":false,"console":"false","complete":"false","x":660.8889808654785,"y":1312.6669473648071,"z":"603ff2c0.9fc00c","wires":[]},{"id":"86fc322f.7903d","type":"function","name":"refererCount","useRequire":false,"func":"var temp=[];\nvar payload=[];\npayload.push([\"来路页面\",\"次数\"]);\nif(msg.payload.length>40)\n{\n    var len=40;\n}\nelse\n{\n    var len=msg.payload.length;\n}\nfor(var i=0;i<len-1;i+=2)\n{\n\tvar referer=msg.payload[i];\n\tvar count=parseInt(msg.payload[i+1]);\n    payload.push([referer,count]);\n}\npayload={\"value\":payload};\nmsg.payload={\n        \"MsgID\":\"adminpush_tablerefererCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;","outputs":1,"x":663.4569435119629,"y":1379.4139566421509,"z":"603ff2c0.9fc00c","wires":[["eae10e83.151ef","826e17e7.7d91e8"]]},{"id":"28e60d77.d719f2","type":"function","name":"del refererCount","useRequire":false,"func":"msg.payload = ['del','refererCount'];\nreturn msg;","outputs":1,"x":460.888916015625,"y":1989.778076171875,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"9bf7921e.64087","type":"redisPub","name":"errTypeCount","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_columnerrTypeCount","x":902.8889465332031,"y":1089.6668090820312,"z":"603ff2c0.9fc00c","wires":[]},{"id":"9c60f0c5.639f1","type":"redisPub","name":"visitPageCount","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_tablevisitPageCount","x":908.888916015625,"y":1253.666748046875,"z":"603ff2c0.9fc00c","wires":[]},{"id":"826e17e7.7d91e8","type":"redisPub","name":"refererCount","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_tablerefererCount","x":919.888916015625,"y":1376.888916015625,"z":"603ff2c0.9fc00c","wires":[]},{"id":"55d05486.aa2fac","type":"function","name":"hostCount","useRequire":false,"func":"var host=msg.payload.host;\nmsg.payload={\"host\":host};\nreturn msg;","outputs":1,"x":600.8890686035156,"y":720.3335266113281,"z":"603ff2c0.9fc00c","wires":[[]]},{"id":"cd73924c.328c7","type":"debug","name":"","active":false,"console":"false","complete":"false","x":813.8890075683594,"y":779.3335266113281,"z":"603ff2c0.9fc00c","wires":[]},{"id":"d105f0da.2efa1","type":"function","name":"userIP","useRequire":false,"func":"var userIP=msg.payload.userIP;\nmsg.payload={\"userIP\":userIP};\nreturn msg;","outputs":1,"x":596.8890075683594,"y":601.3335266113281,"z":"603ff2c0.9fc00c","wires":[["66abbbf0.995444"]]},{"id":"66abbbf0.995444","type":"function","name":"userIPCount","useRequire":false,"func":"var userIP=msg.payload.userIP;\nmsg.payload=['zincrby','userIPCount',1,userIP];\nreturn msg;","outputs":1,"x":792.8889465332031,"y":602.7778625488281,"z":"603ff2c0.9fc00c","wires":[["18fb9d4d.e70463"]]},{"id":"18fb9d4d.e70463","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"userIPCount","x":1013.8889465332031,"y":598.8889465332031,"z":"603ff2c0.9fc00c","wires":[]},{"id":"7a193e99.85e6c","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"userIPCount","key":"userIPCount","structtype":"zset","x":416.8888854980469,"y":1412.3333740234375,"z":"603ff2c0.9fc00c","wires":[["2f86f6aa.d0790a","539d157d.ac62ec"]]},{"id":"539d157d.ac62ec","type":"function","name":"userIPCount","useRequire":false,"func":"var userIP=[];\nvar count=[];\nvar payload=[];\nif(msg.payload.length>=12)\n{\n    var len=12;\n    for(var i=0;i<len-1;i+=2)\n\t{\n\t\tuserIP.push(msg.payload[i]);\n\t\tcount.push(parseInt(msg.payload[i+1]));\n\t}\n\tfor(var i=0;i<userIP.length;++i)\n\t{\n\t\tvar out=[userIP[i],count[i]];\n\t\tpayload.push(out);\n\t}\n\tpayload={\"value\":payload};\n\tmsg.payload={\n        \"MsgID\":\"adminpush_columnuserIPCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\n\tmsg.payload = JSON.stringify(msg.payload);\n\treturn msg;\n}\n","outputs":1,"x":657.8889465332031,"y":1436.5556640625,"z":"603ff2c0.9fc00c","wires":[["fd0d4395.02f2c"]]},{"id":"fd0d4395.02f2c","type":"redisPub","name":"userIPCount","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_columnuserIPCount","x":921.888916015625,"y":1446.444580078125,"z":"603ff2c0.9fc00c","wires":[]},{"id":"6096943c.9f696c","type":"debug","name":"","active":false,"console":"false","complete":"false","x":868.8888854980469,"y":94.88888549804688,"z":"603ff2c0.9fc00c","wires":[]},{"id":"ca12b2bb.35ed5","type":"function","name":"repeatVisit","useRequire":false,"func":"var userIP=msg.payload.userIP;\nvar target=msg.payload.target;\nmsg.payload={\"userIP\":userIP,\"target\":target};\nreturn msg;","outputs":1,"x":601.8889465332031,"y":657.2223205566406,"z":"603ff2c0.9fc00c","wires":[["da4ed251.25b13"]]},{"id":"da4ed251.25b13","type":"function","name":"repeatVisit","useRequire":false,"func":"var userIP=msg.payload.userIP;\nvar target=msg.payload.target;\nvar temp=userIP+':'+target;\nmsg.payload=['zincrby','repeatVisit',1,temp];\nreturn msg;","outputs":1,"x":791.8889465332031,"y":656.2222595214844,"z":"603ff2c0.9fc00c","wires":[["e7a9a327.18566"]]},{"id":"591b380b.a6e4c8","type":"function","name":"del userIPCount","useRequire":false,"func":"msg.payload = ['del','userIPCount'];\nreturn msg;","outputs":1,"x":459.8888854980469,"y":2041.2222900390625,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"e7a9a327.18566","type":"redis-voyager","hostname":"127.0.0.1","port":6379,"name":"repeatVisit","x":1009.8889465332031,"y":652.2222595214844,"z":"603ff2c0.9fc00c","wires":[]},{"id":"d921fa9c.26de08","type":"function","name":"del repeatVisit","useRequire":false,"func":"msg.payload = ['del','repeatVisit'];\nreturn msg;","outputs":1,"x":460.8888854980469,"y":2094.1112060546875,"z":"603ff2c0.9fc00c","wires":[["68287180.97d79"]]},{"id":"91e9e604.6e1618","type":"redis in","hostname":"127.0.0.1","port":6379,"name":"repeatVisit","key":"repeatVisit","structtype":"zset","x":411.8888854980469,"y":1472,"z":"603ff2c0.9fc00c","wires":[["35e5deba.ca1a22","5c546b3d.a3ab94"]]},{"id":"2bd0cf93.d42f3","type":"debug","name":"","active":false,"console":"false","complete":"false","x":673.8889465332031,"y":1474,"z":"603ff2c0.9fc00c","wires":[]},{"id":"35e5deba.ca1a22","type":"function","name":"repeatVisit","useRequire":false,"func":"var temp=[];\nvar payload=[];\npayload.push([\"用户IP\",\"访问页面\",\"访问次数\"]);\nif(msg.payload.length>50)\n{\n    var len=50;\n}\nelse\n{\n    var len=msg.payload.length;\n}\nfor(var i=0;i<len-1;i+=2)\n{\n    temp=msg.payload[i].split(':');\n    var userIP=temp[0];\n    var url=temp[1];\n    var count=msg.payload[i+1];\n    payload.push([userIP,url,count]);\n}\npayload={\"value\":payload};\nmsg.payload={\n        \"MsgID\":\"adminpush_tableerrPageCount\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;","outputs":1,"x":649.8889465332031,"y":1531.2222900390625,"z":"603ff2c0.9fc00c","wires":[["2bd0cf93.d42f3","4267d41.fbd982c"]]},{"id":"4267d41.fbd982c","type":"redisPub","name":"repeatVisit","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_tablerepeatVisit","x":913.8889465332031,"y":1512.3333740234375,"z":"603ff2c0.9fc00c","wires":[]},{"id":"3b286d4d.c4d792","type":"redisPub","name":"repeatVisitRate","host":"127.0.0.1","port":6379,"user":"","passwd":"","channel":"adminpush_pierepeatVisit","x":910.888916015625,"y":1600.3333740234375,"z":"603ff2c0.9fc00c","wires":[]},{"id":"5c546b3d.a3ab94","type":"function","name":"repeatVisitRate","useRequire":false,"func":"var userIP=[];\nvar count=[];\nvar payload=[];\nif(msg.payload.length>=8)\n{\n    var len=8;\n    for(var i=0;i<len-1;i+=2)\n\t{\n\t\tuserIP.push(msg.payload[i].split(':')[0]);\n\t\tcount.push(parseInt(msg.payload[i+1]));\n\t}\n\tfor(var i=0;i<userIP.length;++i)\n\t{\n\t\tvar out=[userIP[i],count[i]];\n\t\tpayload.push(out);\n\t}\n\tpayload={\"value\":payload};\n\tmsg.payload={\n        \"MsgID\":\"adminpush_pierepeatVisit\",\n        \"username\":\"admin\",\n        \"payload\":payload\n    };\n\tmsg.payload = JSON.stringify(msg.payload);\n\treturn msg;\n}\n","outputs":1,"x":663.888916015625,"y":1605.2222900390625,"z":"603ff2c0.9fc00c","wires":[["b45e89ad.4ba178","3b286d4d.c4d792"]]},{"id":"b45e89ad.4ba178","type":"debug","name":"","active":false,"console":"false","complete":"false","x":694.8888854980469,"y":1672.1111400981017,"z":"603ff2c0.9fc00c","wires":[]}]